<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Observation Influence Audit • auditor</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="../dalexverse.css" rel="stylesheet">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../dalexverse-2.css" rel="stylesheet">
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Observation Influence Audit">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- google analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-5650686-14"></script><script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-5650686-14');
</script>
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">auditor</a>
        <div class="info">
          <span class="partof">part of the <a href="https://github.com/ModelOriented/DrWhy">DrWhy.AI</a>
           developed by the <a href="https://mi2.mini.pw.edu.pl/">MI^2 DataLab</a> </span>
          <span class="version version-default">1.0.0</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/model_evaluation_audit.html">Model Evaluation Audit</a>
    </li>
    <li>
      <a href="../articles/model_fit_audit.html">Model Fit Audit</a>
    </li>
    <li>
      <a href="../articles/model_performance_audit.html">Model Performance Audit</a>
    </li>
    <li>
      <a href="../articles/model_residuals_audit.html">Model Residuals Audit</a>
    </li>
    <li>
      <a href="../articles/observation_influence_audit.html">Observation Influence Audit</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
        <li>
  <a href="https://github.com/ModelOriented/auditor">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Observation Influence Audit</h1>
                        <h4 class="author">Alicja Gosiewska</h4>
            
            <h4 class="date">2019-09-10</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ModelOriented/auditor/blob/master/vignettes/observation_influence_audit.Rmd"><code>vignettes/observation_influence_audit.Rmd</code></a></small>
      <div class="hidden name"><code>observation_influence_audit.Rmd</code></div>

    </div>

    
    
<div id="which-observations-are-outlyers" class="section level1">
<h1 class="hasAnchor">
<a href="#which-observations-are-outlyers" class="anchor"></a>Which observations are outlyers?</h1>
</div>
<div id="regression-use-case---dragons-data" class="section level1">
<h1 class="hasAnchor">
<a href="#regression-use-case---dragons-data" class="anchor"></a>Regression use case - dragons data</h1>
<p>To illustrate applications of <em>auditor</em> to regression problems we will use an artificial dataset dragons available in the <a href="https://github.com/pbiecek/DALEX"><em>DALEX</em></a> package. Our goal is to predict the length of life of dragons.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(DALEX)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"dragons"</span>)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(dragons)</a></code></pre></div>
<pre><code>##   year_of_birth   height   weight scars colour year_of_discovery
## 1         -1291 59.40365 15.32391     7    red              1700
## 2          1589 46.21374 11.80819     5    red              1700
## 3          1528 49.17233 13.34482     6    red              1700
## 4          1645 48.29177 13.27427     5  green              1700
## 5            -8 49.99679 13.08757     1    red              1700
## 6           915 45.40876 11.48717     2    red              1700
##   number_of_lost_teeth life_length
## 1                   25   1368.4331
## 2                   28   1377.0474
## 3                   38   1603.9632
## 4                   33   1434.4222
## 5                   18    985.4905
## 6                   20    969.5682</code></pre>
</div>
<div id="models" class="section level1">
<h1 class="hasAnchor">
<a href="#models" class="anchor"></a>Models</h1>
<div id="linear-model" class="section level2">
<h2 class="hasAnchor">
<a href="#linear-model" class="anchor"></a>Linear model</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">lm_model &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(life_length <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> dragons)</a></code></pre></div>
</div>
<div id="random-forest" class="section level2">
<h2 class="hasAnchor">
<a href="#random-forest" class="anchor"></a>Random forest</h2>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"randomForest"</span>)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">59</span>)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">rf_model &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/randomForest/man/randomForest.html">randomForest</a></span>(life_length <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> dragons)</a></code></pre></div>
</div>
</div>
<div id="preparation-for-error-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#preparation-for-error-analysis" class="anchor"></a>Preparation for error analysis</h1>
<p>The beginning of each analysis is creation of an <code>explainer</code> object with DALEX package. It’s an object that can be used to audit a model.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">lm_exp &lt;-<span class="st"> </span>DALEX<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/DALEX/man/explain.html">explain</a></span>(lm_model, <span class="dt">label =</span> <span class="st">"lm"</span>, <span class="dt">data =</span> dragons, <span class="dt">y =</span> dragons<span class="op">$</span>life_length)</a></code></pre></div>
<pre><code>## Preparation of a new explainer is initiated
##   -&gt; model label       :  lm 
##   -&gt; data              :  2000  rows  8  cols 
##   -&gt; target variable   :  2000  values 
##   -&gt; predict function  :  yhat.lm  will be used ([33mdefault[39m)
##   -&gt; predicted values  :  numerical, min =  540.9447 , mean =  1370.986 , max =  3925.691  
##   -&gt; residual function :  difference between y and yhat ([33mdefault[39m)
##   -&gt; residuals         :  numerical, min =  -108.2062 , mean =  -3.701928e-12 , max =  113.8603  
## [32mA new explainer has been created![39m</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">rf_exp &lt;-<span class="st"> </span>DALEX<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/DALEX/man/explain.html">explain</a></span>(rf_model, <span class="dt">label =</span> <span class="st">"rf"</span>, <span class="dt">data =</span> dragons, <span class="dt">y =</span> dragons<span class="op">$</span>life_length)</a></code></pre></div>
<pre><code>## Preparation of a new explainer is initiated
##   -&gt; model label       :  rf 
##   -&gt; data              :  2000  rows  8  cols 
##   -&gt; target variable   :  2000  values 
##   -&gt; predict function  :  yhat.randomForest  will be used ([33mdefault[39m)
##   -&gt; predicted values  :  numerical, min =  610.9752 , mean =  1370.181 , max =  3292.296  
##   -&gt; residual function :  difference between y and yhat ([33mdefault[39m)
##   -&gt; residuals         :  numerical, min =  -135.4756 , mean =  0.8047108 , max =  720.0888  
## [32mA new explainer has been created![39m</code></pre>
</div>
<div id="audit-of-observations" class="section level1">
<h1 class="hasAnchor">
<a href="#audit-of-observations" class="anchor"></a>Audit of observations</h1>
<p>In this section we give short overview of a visual validation of model errors and show the propositions for the validation scores. Auditor helps to find answers for questions that may be crucial for further analyses.</p>
<ul>
<li><p>Does the model fit data? Is it not missing the information?</p></li>
<li><p>Which model has better performance?</p></li>
<li><p>How similar models are?</p></li>
</ul>
<p>In further sections, we overview auditor functions for analysis of model residuals. They are discussed in alphabetical order.</p>
<div id="observationinfluence" class="section level2">
<h2 class="hasAnchor">
<a href="#observationinfluence" class="anchor"></a>observationInfluence()</h2>
<p>First, we need to create a <code>auditor_model_residual</code> objects.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(auditor)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">lm_cd &lt;-<span class="st"> </span><span class="kw"><a href="../reference/model_cooksdistance.html">model_cooksdistance</a></span>(lm_exp)</a></code></pre></div>
<p>Some plots may require specified variable or fitted values for <code>modelResidual</code> object.</p>
<div id="cooks-distances" class="section level3">
<h3 class="hasAnchor">
<a href="#cooks-distances" class="anchor"></a>Cook’s distances</h3>
<p>Cook’s distance is used to estimate of the influence of an single observation. It is a tool for identifying observations that may negatively affect the model.</p>
<p>Data points indicated by Cook’s distances are worth checking for validity. Cook’s distances may be also used for indicating regions of the design space where it would be good to obtain more observations.</p>
<p>Cook’s Distances are calculated by removing the i-th observation from the data and recalculating the model. It shows how much all the values in the model change when the i-th observation is removed.</p>
<p>In the case of models of classes other than <code>lm</code> and <code>glm</code> the distances are computed directly from the definition, so this may take a while. In this example we will compute them for a linear model.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(lm_cd)</a></code></pre></div>
<p><img src="observation_influence_audit_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
</div>
</div>
</div>
<div id="other-methods" class="section level1">
<h1 class="hasAnchor">
<a href="#other-methods" class="anchor"></a>Other methods</h1>
<p>Other methods and plots are described in vignettes:</p>
<ul>
<li><p><a href="https://modeloriented.github.io/auditor/articles/model_residuals_audit.html">Model Residuals audit</a></p></li>
<li><p><a href="https://modeloriented.github.io/auditor/articles/model_evaluation_audit.html">Model Evaluation audit</a></p></li>
<li><p><a href="https://modeloriented.github.io/auditor/articles/model_fit_audit.html">Model Fit audit</a></p></li>
<li><p><a href="https://modeloriented.github.io/auditor/articles/model_performance_audit.html">Model Performance audit</a></p></li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#which-observations-are-outlyers">Which observations are outlyers?</a></li>
      <li><a href="#regression-use-case---dragons-data">Regression use case - dragons data</a></li>
      <li>
<a href="#models">Models</a><ul class="nav nav-pills nav-stacked">
<li><a href="#linear-model">Linear model</a></li>
      <li><a href="#random-forest">Random forest</a></li>
      </ul>
</li>
      <li><a href="#preparation-for-error-analysis">Preparation for error analysis</a></li>
      <li>
<a href="#audit-of-observations">Audit of observations</a><ul class="nav nav-pills nav-stacked">
<li><a href="#observationinfluence">observationInfluence()</a></li>
      </ul>
</li>
      <li><a href="#other-methods">Other methods</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="author">
  <p>
    Developed by Alicja Gosiewska, Przemyslaw Biecek, Hubert Baniecki, Tomasz Mikołajczyk.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a>.
  </p>
</div>

      </footer>
</div>

  


  </body>
</html>
